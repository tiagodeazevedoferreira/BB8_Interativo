<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo BB-8 Caça-Luz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: radial-gradient(circle at top, #0f172a 0, #020617 60%);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 0.75rem 1rem;
      text-align: center;
      background: rgba(15, 23, 42, 0.9);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
      z-index: 2;
    }

    header h1 {
      font-size: 1.25rem;
      margin-bottom: 0.25rem;
    }

    header p {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .hud {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 0.35rem;
      font-size: 0.85rem;
    }

    .hud span {
      min-width: 90px;
      text-align: center;
    }

    #gameArea {
      flex: 1;
      position: relative;
      cursor: crosshair;
      overflow: hidden;
    }

    #gameArea::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(148, 163, 184, 0.11) 0, transparent 40%),
        radial-gradient(circle at 80% 60%, rgba(96, 165, 250, 0.12) 0, transparent 45%),
        radial-gradient(circle at 40% 90%, rgba(251, 191, 36, 0.12) 0, transparent 50%);
      pointer-events: none;
    }

    /* BB-8 */
    #bb8 {
      position: absolute;
      width: 90px;
      height: 90px;
      transform-origin: center bottom;
      transition: transform 0.15s linear;
      pointer-events: none;
      perspective: 400px;
    }

    .bb8-shadow {
      position: absolute;
      width: 70%;
      height: 20px;
      background: radial-gradient(circle, rgba(15, 23, 42, 0.9) 0, transparent 70%);
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%) skewX(-8deg) scaleY(0.6);
      opacity: 0.75;
      filter: blur(4px);
      pointer-events: none;
    }

    /* Corpo esférico com aparência 3D */
    .bb8-body {
      position: absolute;
      width: 68px;
      height: 68px;
      border-radius: 50%;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      background:
        radial-gradient(circle at 30% 22%, rgba(255, 255, 255, 0.95) 0, rgba(255, 255, 255, 0.4) 18%, transparent 40%),
        radial-gradient(circle at 70% 70%, rgba(15, 23, 42, 0.55) 0, rgba(15, 23, 42, 0.9) 55%, transparent 75%),
        radial-gradient(circle at center, #e5e7eb 0, #e5e7eb 45%, #cbd5f5 65%, #94a3b8 85%, #64748b 100%);
      border: 3px solid #e5e7eb;
      box-shadow:
        0 10px 18px rgba(15, 23, 42, 0.9),
        0 0 4px rgba(15, 23, 42, 0.6),
        inset 0 0 3px rgba(255, 255, 255, 0.8),
        inset 0 -4px 8px rgba(15, 23, 42, 0.85);
      overflow: hidden;
    }

    /* Anéis e detalhes do corpo */
    .bb8-body::before {
      content: "";
      position: absolute;
      inset: 12%;
      border-radius: 50%;
      border: 3px solid rgba(148, 163, 184, 0.75);
      box-shadow:
        0 0 0 3px rgba(249, 115, 22, 0.9),
        inset 0 0 10px rgba(15, 23, 42, 0.5);
      background:
        radial-gradient(circle at 35% 35%, #f97316 0, #f97316 35%, transparent 40%),
        radial-gradient(circle at 68% 60%, #f97316 0, #f97316 30%, transparent 36%);
    }

    /* Head “semi-esfera” com luz */
    .bb8-head {
      position: absolute;
      width: 52px;
      height: 32px;
      top: 2px;
      left: 50%;
      transform: translate(-50%, 0);
      border-radius: 52px 52px 28px 28px;
      background:
        radial-gradient(circle at 22% 30%, rgba(255, 255, 255, 0.95) 0, transparent 38%),
        linear-gradient(to bottom, #f9fafb 0%, #e5e7eb 45%, #cbd5f5 100%);
      border: 3px solid #e5e7eb;
      box-shadow:
        0 4px 8px rgba(15, 23, 42, 0.85),
        inset 0 0 4px rgba(148, 163, 184, 0.8);
    }

    /* Faixa e “olhos” */
    .bb8-head::before {
      content: "";
      position: absolute;
      inset: 4px 4px auto 4px;
      height: 8px;
      border-radius: 999px;
      background:
        linear-gradient(to right, #0f172a 0, #0f172a 30%, #f97316 45%, #f97316 55%, #0f172a 70%, #0f172a 100%);
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.7);
    }

    .bb8-head::after {
      content: "";
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      top: 10px;
      left: 16px;
      background: radial-gradient(circle, #ffffff 0, #9ca3af 40%, #020617 75%);
      box-shadow:
        0 0 6px rgba(59, 130, 246, 0.9),
        inset 0 0 3px rgba(15, 23, 42, 0.9);
    }

    /* Antena com leve perspectiva */
    .bb8-antenna {
      position: absolute;
      width: 2px;
      height: 18px;
      background: linear-gradient(to top, #e5e7eb, #ffffff);
      top: -16px;
      left: 70%;
      border-radius: 999px;
      box-shadow:
        0 -3px 0 #f97316,
        0 0 4px rgba(249, 115, 22, 0.9);
    }

    /* Estados de animação */
    .bb8-moving .bb8-body {
      animation: roll 0.35s linear infinite;
    }

    @keyframes roll {
      from { transform: translateX(-50%) rotate(0deg); }
      to   { transform: translateX(-50%) rotate(360deg); }
    }

    .bb8-moving .bb8-shadow {
      animation: shadowPulse 0.4s ease-in-out infinite alternate;
    }

    @keyframes shadowPulse {
      from { transform: translateX(-50%) skewX(-8deg) scaleX(1) scaleY(0.6); opacity: 0.75; }
      to   { transform: translateX(-50%) skewX(-10deg) scaleX(1.15) scaleY(0.55); opacity: 0.5; }
    }

    .bb8-eating .bb8-head {
      animation: eat 0.45s ease-in-out 2;
    }

    @keyframes eat {
      0%   { transform: translate(-50%, 0) rotate(0deg); }
      25%  { transform: translate(-50%, 2px) rotate(-8deg); }
      50%  { transform: translate(-50%, -1px) rotate(10deg); }
      75%  { transform: translate(-50%, 2px) rotate(-6deg); }
      100% { transform: translate(-50%, 0) rotate(0deg); }
    }

    /* Luz (comida) */
    #light {
      position: absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: radial-gradient(circle, #facc15 0, #f97316 40%, transparent 70%);
      box-shadow:
        0 0 10px rgba(250, 204, 21, 0.9),
        0 0 22px rgba(251, 191, 36, 0.8);
      transform: translate(-50%, -50%);
      opacity: 0;
      pointer-events: none;
    }

    #light::before {
      content: "";
      position: absolute;
      inset: 15%;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.95) 0, transparent 60%);
      mix-blend-mode: screen;
    }

    .light-visible {
      animation: lightPop 0.25s ease-out forwards, lightPulse 1.4s ease-in-out infinite;
    }

    @keyframes lightPop {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.4); }
      100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    @keyframes lightPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(250, 204, 21, 0.8), 0 0 22px rgba(251, 191, 36, 0.6); }
      50% { box-shadow: 0 0 16px rgba(250, 204, 21, 1), 0 0 28px rgba(251, 191, 36, 0.95); }
    }

    footer {
      padding: 0.4rem 0.75rem;
      font-size: 0.75rem;
      text-align: center;
      color: #9ca3af;
      background: rgba(15, 23, 42, 0.92);
      border-top: 1px solid rgba(55, 65, 81, 0.7);
    }

    @media (max-width: 640px) {
      #bb8 {
        width: 72px;
        height: 72px;
      }
      .bb8-body {
        width: 56px;
        height: 56px;
      }
      header h1 {
        font-size: 1.05rem;
      }
      .hud {
        gap: 0.75rem;
        font-size: 0.78rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>BB-8 Caçador de Luz</h1>
    <p>Clique em qualquer lugar da tela: o BB-8 irá até a luz e vai “comê-la”.</p>
    <div class="hud">
      <span>Luzes comidas: <strong id="score">0</strong></span>
      <span>Último tempo: <strong id="lastTime">0.0s</strong></span>
      <span>Recorde: <strong id="bestTime">0.0s</strong></span>
    </div>
  </header>

  <main id="gameArea">
    <div id="bb8">
      <div class="bb8-shadow"></div>
      <div class="bb8-body"></div>
      <div class="bb8-head">
        <div class="bb8-antenna"></div>
      </div>
    </div>

    <div id="light"></div>
  </main>

  <footer>
    Dica: clique em vários pontos seguidos para desafiar o tempo de reação do BB-8.
  </footer>

  <script>
    const gameArea = document.getElementById("gameArea");
    const bb8 = document.getElementById("bb8");
    const light = document.getElementById("light");
    const scoreEl = document.getElementById("score");
    const lastTimeEl = document.getElementById("lastTime");
    const bestTimeEl = document.getElementById("bestTime");

    const ROBOT_SPEED = 260;     // pixels por segundo
    const EAT_DURATION = 600;    // ms que o BB-8 “come” a luz
    const ARRIVE_THRESHOLD = 6;  // distância mínima para considerar que chegou

    let bb8X = 150;
    let bb8Y = 150;
    let targetX = bb8X;
    let targetY = bb8Y;
    let moving = false;
    let eating = false;
    let lastLightTime = 0;
    let score = 0;
    let bestTime = 0;

    function setInitialPosition() {
      const rect = gameArea.getBoundingClientRect();
      bb8X = rect.width / 2;
      bb8Y = rect.height / 2;
      targetX = bb8X;
      targetY = bb8Y;
      updateBB8Position();
    }

    function updateBB8Position() {
      bb8.style.left = bb8X + "px";
      bb8.style.top = bb8Y + "px";
    }

    function placeLight(x, y) {
      light.style.left = x + "px";
      light.style.top = y + "px";
      light.classList.add("light-visible");
      light.style.opacity = "1";
    }

    function hideLight() {
      light.classList.remove("light-visible");
      light.style.opacity = "0";
    }

    function onClickGameArea(e) {
      if (e.target === light) return;

      const rect = gameArea.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;

      const padding = 35;
      const clampedX = Math.min(rect.width - padding, Math.max(padding, clickX));
      const clampedY = Math.min(rect.height - padding, Math.max(padding, clickY));

      targetX = clampedX;
      targetY = clampedY;
      moving = true;
      eating = false;
      bb8.classList.add("bb8-moving");
      bb8.classList.remove("bb8-eating");

      const dx = targetX - bb8X;
      const dy = targetY - bb8Y;
      const angle = Math.atan2(dy, dx);
      const deg = angle * 180 / Math.PI;
      const tilt = Math.max(-10, Math.min(10, deg / 5));
      bb8.style.transform = "rotate(" + tilt + "deg)";

      placeLight(targetX, targetY);
      lastLightTime = performance.now();
    }

    function gameLoop(timestamp) {
      if (moving && !eating) {
        const dt = Math.min(32, timestamp - (gameLoop.lastTime || timestamp)) / 1000;
        const dx = targetX - bb8X;
        const dy = targetY - bb8Y;
        const distance = Math.hypot(dx, dy);

        if (distance < ARRIVE_THRESHOLD) {
          bb8X = targetX;
          bb8Y = targetY;
          updateBB8Position();
          moving = false;
          bb8.classList.remove("bb8-moving");
          startEating();
        } else {
          const vx = (dx / distance) * ROBOT_SPEED;
          const vy = (dy / distance) * ROBOT_SPEED;
          bb8X += vx * dt;
          bb8Y += vy * dt;
          updateBB8Position();
        }
      }

      gameLoop.lastTime = timestamp;
      requestAnimationFrame(gameLoop);
    }

    function startEating() {
      if (!light.classList.contains("light-visible")) return;
      eating = true;
      bb8.classList.add("bb8-eating");

      const now = performance.now();
      const travelTimeMs = now - lastLightTime;
      const travelTime = travelTimeMs / 1000;

      score++;
      scoreEl.textContent = score;

      lastTimeEl.textContent = travelTime.toFixed(2) + "s";
      if (bestTime === 0 || travelTime < bestTime) {
        bestTime = travelTime;
        bestTimeEl.textContent = bestTime.toFixed(2) + "s";
      }

      setTimeout(() => {
        hideLight();
        bb8.classList.remove("bb8-eating");
        eating = false;
      }, EAT_DURATION);
    }

    window.addEventListener("resize", setInitialPosition);
    gameArea.addEventListener("click", onClickGameArea);

    window.addEventListener("load", () => {
      setInitialPosition();
      requestAnimationFrame(gameLoop);
    });
  </script>
</body>
</html>
